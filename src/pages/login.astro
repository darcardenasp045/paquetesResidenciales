---
import { useState } from 'react';

type FormState = {
  username: string;
  password: string;
};

const [formState, setFormState] = useState<FormState>({ username: '', password: '' });
const [error, setError] = useState<string | null>(null);

const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {
  const { name, value } = event.target;
  setFormState(prevState => ({ ...prevState, [name]: value }));
};

const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {
  event.preventDefault();

  try {
    const response = await fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formState),
    });

    if (!response.ok) {
      throw new Error('Login failed');
    }

    // Redirect or handle successful login
    window.location.href = '/welcome';
  } catch (error) {
    setError('Invalid username or password');
  }
};
---

<main class="container mx-auto p-6">
  <h1 class="text-2xl font-bold mb-4">Login</h1>
  <form onSubmit={handleSubmit} class="max-w-sm mx-auto">
    <div class="mb-4">
      <label htmlFor="username" class="block text-sm font-medium text-gray-700">Username</label>
      <input
        type="text"
        id="username"
        name="username"
        value={formState.username}
        onChange={handleChange}
        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        required
      />
    </div>
    <div class="mb-4">
      <label htmlFor="password" class="block text-sm font-medium text-gray-700">Password</label>
      <input
        type="password"
        id="password"
        name="password"
        value={formState.password}
        onChange={handleChange}
        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
        required
      />
    </div>
    {error && <p class="text-red-500 text-sm">{error}</p>}
    <button
      type="submit"
      class="w-full bg-blue-500 text-white py-2 px-4 rounded-md shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
    >
      Login
    </button>
  </form>
</main>
